<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    Spring/Spring Boot重点知识整理 |
    
    Wry&#39;s blog</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
<main class="content">
  <section class="outer">
  <article id="post-Spring-Spring-Boot重点知识整理" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

    <div class="article-inner">
        
            <header class="article-header">
                
  
    <h1 class="article-title" itemprop="name">
      Spring/Spring Boot重点知识整理
    </h1>
  
  




            </header>
            

                
                    <div class="article-meta">
                        <a href="/2020/04/17/Spring-Spring-Boot%E9%87%8D%E7%82%B9%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/" class="article-date">
  <time datetime="2020-04-17T06:52:47.000Z" itemprop="datePublished">2020-04-17</time>
</a>
                            
  <div class="article-category">
    <a class="article-category-link" href="/categories/Spring-Spring-Boot/">Spring/Spring Boot</a>
  </div>

                    </div>
                    

                        
                            
    <div class="tocbot"></div>





                                

                                    <div class="article-entry" itemprop="articleBody">
                                        

                                            

                                                
                                                                    <p>这篇文章主要整理了Spring/SpringBoot的重点知识。</p>
<a id="more"></a>

<h5 id="Why-Spring"><a href="#Why-Spring" class="headerlink" title="Why Spring"></a>Why Spring</h5><ul>
<li><strong>非侵入式</strong>：支持基于POJO的编程模式，不强制性的要求实现Spring框架中的接口或继承Spring框架中的类，这些功能赋予了将其与其他技术结合使用的灵活性。例如，我们可以使用@Inject不是基于Spring的注解的注解来注入依赖项。</li>
<li><strong>IOC容器</strong>：IoC容器帮助应用程序管理对象以及对象之间的依赖关系，对象之间的依赖关系如果发生了改变只需要修改配置文件而不是修改代码，因为代码的修改可能意味着项目的重新构建和完整的回归测试。有了IoC容器，程序员再也不需要自己编写工厂、单例，这一点特别符合Spring的精神“不要重复的发明轮子”。</li>
<li><strong>AOP（面向切面编程）</strong>：将所有的横切关注功能封装到切面（aspect）中，通过配置的方式将横切关注功能动态添加到目标代码上，进一步实现了业务逻辑和系统服务之间的分离。另一方面，有了AOP程序员可以省去很多自己写代理类的工作。</li>
<li><strong>事务管理</strong>：Spring以宽广的胸怀接纳多种持久层技术，并且为其提供了声明式的事务管理，在不需要任何一行代码的情况下就能够完成事务管理。</li>
<li><strong>MVC</strong>：Spring的MVC框架是非常优秀的，为Web表示层提供了更好的解决方案。</li>
<li><strong>异常处理</strong>：Spring Framework提供了多个选项，以更好，更灵活的方式处理异常。</li>
</ul>
<h5 id="Spring-IOC"><a href="#Spring-IOC" class="headerlink" title="Spring IOC"></a>Spring IOC</h5><p>IOC即Inversion of control，直译过来就是控制反转，它的意思是将对象，以及对象之间的引用关系，交给容器管理（The IOC container）。</p>
<p>在IOC出现以前，组件之间的协调关系是由程序内部代码来控制的，或者说，以前我们使用New object()这样子的语法实现两组件之间的依赖关系的。这种方式就造成了组件之间的互相耦合。IOC(控制反转)就是来解决这个问题的，它将实现组件间的关系从程序内部提到外部容器来管理（The IOC container）。也就是说，由容器在运行期将组件间的某种依赖关系动态的注入组件中。</p>
<p><strong>Spring所倡导的开发方式就是如此，所有的类都会在spring容器中登记，告诉spring你是个什么东西，你需要什么东西，然后spring会在系统运行到适当的时候，把你要的东西主动给你，同时也把你交给其他需要你的东西。所有的类的创建、销毁都由 spring来控制，也就是说控制对象生存周期的不再是引用它的对象，而是spring。对于某个具体的对象而言，以前是它控制其他对象，现在是所有对象都被spring控制，所以这叫控制反转。</strong></p>
<p>IOC是基于工厂模式加反射机制实现的。</p>
<h5 id="Spring-Bean作用域"><a href="#Spring-Bean作用域" class="headerlink" title="Spring Bean作用域"></a>Spring Bean作用域</h5><table>
<thead>
<tr>
<th>作用域</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>singleton</td>
<td>单例模式，在整个Spring IoC容器中，singleton作用域的Bean将只生成一个实例，为Spring的默认值</td>
</tr>
<tr>
<td>prototype</td>
<td>每次注入或者通过Spring应用上下文获取的时候，都会创建一个新的Bean。</td>
</tr>
<tr>
<td>request</td>
<td>对于一次HTTP请求，request作用域的Bean将只生成一个实例，这意味着，在同一次HTTP请求内，程序每次请求该Bean，得到的总是同一个实例。</td>
</tr>
<tr>
<td>session</td>
<td>该作用域将 bean 的定义限制为 HTTP 会话。在web应用中为每一个会话创建一个Bean实例。</td>
</tr>
</tbody></table>
<p>通常可以这样子设置Bean的作用域</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</span><br></pre></td></tr></table></figure>
<p>或者这样子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id&#x3D;&quot;xx&quot; class&#x3D;&quot;xx.xx.xx&quot; scope&#x3D;&quot;prototype&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>

<h5 id="Bean的生命周期"><a href="#Bean的生命周期" class="headerlink" title="Bean的生命周期"></a>Bean的生命周期</h5><p><img src="https://img-blog.csdnimg.cn/20200218153558956.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dhbmdjaGVuZ21pbmcx,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ol>
<li>Spring对Bean进行实例化</li>
<li>Spring将值和Bean的引用注入到Bean对应的属性中</li>
<li>如果Bean实现了BeanNameAware接口，Spring将Bean的ID传给setBean-Name()方法</li>
<li>如果Bean实现了BeanFactoryAware接口，Spring将调用setBeanFactory()方法，将BeanFactory容器实例传入</li>
<li>如果Bean实现了ApplicationContextAware接口，Spring将调用setApplicationContext()方法，将Bean所在的应用上下文的引用传入进来</li>
<li>如果Bean实现了BeanPostProcessor接口，Spring将调用它们的post-ProcessBeforeInitialization()方法</li>
<li>如果Bean实现了InitializingBean接口，Spring将调用它们的after-PropertiesSet()方法。类似的，如果Bean使用了init-method生命了初始化方法，该方法也会被调用。</li>
<li>如果Bean实现了BeanPostProcessor接口，Spring将调用它们的post-ProcessAfterInitialization()方法</li>
<li>至此，Bean已经准备就绪，可以被应用程序使用了</li>
<li>如果Bean实现了DisposableBean接口，Spring将调用它的destory()方法。同样，如果Bean使用了destory-method声明了销毁方法，该方法也会被调用。</li>
</ol>
<h5 id="Bean注入的三种方式"><a href="#Bean注入的三种方式" class="headerlink" title="Bean注入的三种方式"></a>Bean注入的三种方式</h5><ul>
<li>基于XML的bean定义（需要提供setter方法）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class Student &#123;</span><br><span class="line"></span><br><span class="line">	private String name;</span><br><span class="line">	</span><br><span class="line">	private Teacher teacher;</span><br><span class="line"></span><br><span class="line">	public String getName() &#123;</span><br><span class="line">		return name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setName(String name) &#123;</span><br><span class="line">		this.name &#x3D; name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Teacher getTeacher() &#123;</span><br><span class="line">		return teacher;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setTeacher(Teacher teacher) &#123;</span><br><span class="line">		this.teacher &#x3D; teacher;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Teacher &#123;</span><br><span class="line"></span><br><span class="line">	private String name;</span><br><span class="line"></span><br><span class="line">	public String getName() &#123;</span><br><span class="line">		return name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void setName(String name) &#123;</span><br><span class="line">		this.name &#x3D; name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">       xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">       xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd&quot;&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;bean id&#x3D;&quot;student&quot; class&#x3D;&quot;com.demo.ioc.Bean.Student&quot;&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;name&quot; value&#x3D;&quot;张三&quot;&#x2F;&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;teacher&quot; ref&#x3D;&quot;teacher&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;bean id&#x3D;&quot;teacher&quot; class&#x3D;&quot;com.demo.ioc.Bean.Teacher&quot;&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;name&quot; value&#x3D;&quot;李四&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line">&lt;&#x2F;beans&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.context.support.FileSystemXmlApplicationContext;</span><br><span class="line"></span><br><span class="line">import com.demo.ioc.Bean.Student;</span><br><span class="line">import com.demo.ioc.Bean.Teacher;</span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String args[]) throws Exception&#123;</span><br><span class="line">        FileSystemXmlApplicationContext context &#x3D; new FileSystemXmlApplicationContext(&quot;src&#x2F;main&#x2F;resources&#x2F;bean1.xml&quot;);</span><br><span class="line">        Student student &#x3D; (Student) context.getBean(&quot;student&quot;);</span><br><span class="line">        Teacher teacher &#x3D; (Teacher) context.getBean(&quot;teacher&quot;);</span><br><span class="line">        System.out.println(&quot;学生的姓名：&quot;+student.getName()+&quot;。老师是&quot;+student.getTeacher().getName());</span><br><span class="line">        System.out.println(&quot;老师的姓名：&quot;+teacher.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>基于注解的bean定义（不需要提供setter方法）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component(&quot;student&quot;)</span><br><span class="line">public class Student &#123;</span><br><span class="line"></span><br><span class="line">	@Value(&quot;张三&quot;)</span><br><span class="line">	private String name;</span><br><span class="line">	</span><br><span class="line">	@Resource</span><br><span class="line">	private Teacher teacher;</span><br><span class="line"></span><br><span class="line">	public String getName() &#123;</span><br><span class="line">		return name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;	public void setName(String name) &#123;</span><br><span class="line">&#x2F;&#x2F;		this.name &#x3D; name;</span><br><span class="line">&#x2F;&#x2F;	&#125;</span><br><span class="line"></span><br><span class="line">	public Teacher getTeacher() &#123;</span><br><span class="line">		return teacher;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;	public void setTeacher(Teacher teacher) &#123;</span><br><span class="line">&#x2F;&#x2F;		this.teacher &#x3D; teacher;</span><br><span class="line">&#x2F;&#x2F;	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component(&quot;teacher&quot;)</span><br><span class="line">public class Teacher &#123;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;李四&quot;)</span><br><span class="line">	private String name;</span><br><span class="line"></span><br><span class="line">	public String getName() &#123;</span><br><span class="line">		return name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;	public void setName(String name) &#123;</span><br><span class="line">&#x2F;&#x2F;		this.name &#x3D; name;</span><br><span class="line">&#x2F;&#x2F;	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">       xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">       xmlns:context&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&quot;</span><br><span class="line">       xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans</span><br><span class="line">       http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd</span><br><span class="line">       http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context</span><br><span class="line">       http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&#x2F;spring-context.xsd&quot;&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;!--扫描组件的包目录--&gt;</span><br><span class="line">    &lt;context:component-scan base-package&#x3D;&quot;com.demo.ioc.Bean&quot;&#x2F;&gt;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;beans&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.context.support.FileSystemXmlApplicationContext;</span><br><span class="line"></span><br><span class="line">import com.demo.ioc.Bean.Student;</span><br><span class="line">import com.demo.ioc.Bean.Teacher;</span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String args[]) throws Exception&#123;</span><br><span class="line">        FileSystemXmlApplicationContext context &#x3D; new FileSystemXmlApplicationContext(&quot;src&#x2F;main&#x2F;resources&#x2F;bean2.xml&quot;);</span><br><span class="line">        Student student &#x3D; (Student) context.getBean(&quot;student&quot;);</span><br><span class="line">        Teacher teacher &#x3D; (Teacher) context.getBean(&quot;teacher&quot;);</span><br><span class="line">        System.out.println(&quot;学生的姓名：&quot;+student.getName()+&quot;。老师是&quot;+student.getTeacher().getName());</span><br><span class="line">        System.out.println(&quot;老师的姓名：&quot;+teacher.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>基于JavaConfig定义（需要提供setter方法）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class BeansConfiguration &#123;</span><br><span class="line"> </span><br><span class="line">    @Bean</span><br><span class="line">    public Student student()&#123;</span><br><span class="line">        Student student&#x3D;new Student();</span><br><span class="line">        student.setName(&quot;张三&quot;);</span><br><span class="line">        student.setTeacher(teacher());</span><br><span class="line">        return student;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    @Bean</span><br><span class="line">    public Teacher teacher()&#123;</span><br><span class="line">        Teacher teacher&#x3D;new Teacher();</span><br><span class="line">        teacher.setName(&quot;李四&quot;);</span><br><span class="line">        return teacher;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line">import com.demo.ioc.Bean.BeansConfiguration;</span><br><span class="line">import com.demo.ioc.Bean.Student;</span><br><span class="line">import com.demo.ioc.Bean.Teacher;</span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String args[]) throws Exception&#123;</span><br><span class="line">		AnnotationConfigApplicationContext context &#x3D; new AnnotationConfigApplicationContext(BeansConfiguration.class);</span><br><span class="line">&#x2F;&#x2F;        FileSystemXmlApplicationContext context &#x3D; new FileSystemXmlApplicationContext(&quot;src&#x2F;main&#x2F;resources&#x2F;bean2.xml&quot;);</span><br><span class="line">        Student student &#x3D; (Student) context.getBean(&quot;student&quot;);</span><br><span class="line">        Teacher teacher &#x3D; (Teacher) context.getBean(&quot;teacher&quot;);</span><br><span class="line">        System.out.println(&quot;学生的姓名：&quot;+student.getName()+&quot;。老师是&quot;+student.getTeacher().getName());</span><br><span class="line">        System.out.println(&quot;老师的姓名：&quot;+teacher.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Spring如何标记首选的Bean"><a href="#Spring如何标记首选的Bean" class="headerlink" title="Spring如何标记首选的Bean"></a>Spring如何标记首选的Bean</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@Primary</span><br><span class="line">public class Student &#123;</span><br><span class="line">	&#x2F;&#x2F; todo...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="限定自动装配的Bean"><a href="#限定自动装配的Bean" class="headerlink" title="限定自动装配的Bean"></a>限定自动装配的Bean</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">   @Qualifier(&quot;student&quot;)</span><br><span class="line">   public void setName(String policyName) &#123;</span><br><span class="line">       this.policyName &#x3D; policyName;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h5 id="Spring-自动装配Bean的方法"><a href="#Spring-自动装配Bean的方法" class="headerlink" title="Spring 自动装配Bean的方法"></a>Spring 自动装配Bean的方法</h5><ul>
<li>no：默认值，表示没有自动装配，应使用显式 bean 引用进行装配。</li>
<li>byName：它根据 bean 的名称注入对象依赖项。</li>
<li>byType：它根据类型注入对象依赖项。</li>
<li>构造函数：通过构造函数来注入依赖项，需要设置大量的参数。</li>
<li>autodetect：容器首先通过构造函数使用 autowire 装配，如果不能，则通过 byType 自动装配。</li>
</ul>
<h5 id="BeanFactory和ApplicationContext的区别"><a href="#BeanFactory和ApplicationContext的区别" class="headerlink" title="BeanFactory和ApplicationContext的区别"></a>BeanFactory和ApplicationContext的区别</h5><ul>
<li>BeanFactory：是Spring里面最底层的接口，包含了各种Bean的定义，读取bean配置文档，管理bean的加载、实例化，控制bean的生命周期，维护bean之间的依赖关系。ApplicationContext接口作为BeanFactory的派生，除了提供BeanFactory所具有的功能外，还提供了更完整的框架功能：<ul>
<li>继承MessageSource，因此支持国际化。</li>
<li>统一的资源文件访问方式。</li>
<li>提供在监听器中注册bean的事件。</li>
<li>同时加载多个配置文件。</li>
<li>载入多个（有继承关系）上下文 ，使得每一个上下文都专注于一个特定的层次，比如应用的web层。</li>
</ul>
</li>
<li>BeanFactroy采用的是延迟加载形式来注入Bean的，即只有在使用到某个Bean时(调用getBean())，才对该Bean进行加载实例化。这样，我们就不能发现一些存在的Spring的配置问题。如果Bean的某一个属性没有注入，BeanFacotry加载后，直至第一次使用调用getBean方法才会抛出异常。</li>
<li>BeanFactory通常以编程的方式被创建，ApplicationContext还能以声明的方式创建，如使用ContextLoader。</li>
<li>BeanFactory和ApplicationContext都支持BeanPostProcessor、BeanFactoryPostProcessor的使用，但两者之间的区别是：BeanFactory需要手动注册，而ApplicationContext则是自动注册。</li>
</ul>
<h5 id="Autowire如何实现注入Bean"><a href="#Autowire如何实现注入Bean" class="headerlink" title="@Autowire如何实现注入Bean"></a>@Autowire如何实现注入Bean</h5><ul>
<li>这是@Autowire注解的定义</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Target(&#123;ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.PARAMETER, ElementType.FIELD, ElementType.ANNOTATION_TYPE&#125;)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">public @interface Autowired &#123;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * Declares whether the annotated dependency is required.</span><br><span class="line">	 * &lt;p&gt;Defaults to &#123;@code true&#125;.</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	boolean required() default true;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Java中注解的实现方式是通过反射来实现，反射的大概步骤如下：</p>
<ul>
<li>利用反射机制获取一个类的Class对象</li>
<li>通过这个class对象可以去获取他的每一个方法method，或字段Field等等</li>
<li>Method，Field等类提供了类似于getAnnotation的方法来获取这个一个字段的所有注解</li>
<li>拿到注解之后，我们可以判断这个注解是否是我们要实现的注解，如果是则实现注解逻辑</li>
</ul>
</li>
<li><p>所有的实现逻辑都在<code>org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor</code>，核心代码如下：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">private InjectionMetadata buildAutowiringMetadata(final Class&lt;?&gt; clazz) &#123;</span><br><span class="line">		List&lt;InjectionMetadata.InjectedElement&gt; elements &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">		&#x2F;&#x2F; 需要处理的目标类</span><br><span class="line">		Class&lt;?&gt; targetClass &#x3D; clazz;</span><br><span class="line"></span><br><span class="line">		do &#123;</span><br><span class="line">			final List&lt;InjectionMetadata.InjectedElement&gt; currElements &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">			&#x2F;&#x2F; 通过反射获取所有字段，通过findAutowiredAnnotation查找每个字段的注解，如果用autowired修饰则返回autowired相关属性</span><br><span class="line">			ReflectionUtils.doWithLocalFields(targetClass, field -&gt; &#123;</span><br><span class="line">				AnnotationAttributes ann &#x3D; findAutowiredAnnotation(field);</span><br><span class="line">				if (ann !&#x3D; null) &#123;</span><br><span class="line">					&#x2F;&#x2F; 是否用在了static字段上</span><br><span class="line">					if (Modifier.isStatic(field.getModifiers())) &#123;</span><br><span class="line">						if (logger.isWarnEnabled()) &#123;</span><br><span class="line">							logger.warn(&quot;Autowired annotation is not supported on static fields: &quot; + field);</span><br><span class="line">						&#125;</span><br><span class="line">						return;</span><br><span class="line">					&#125;</span><br><span class="line">					&#x2F;&#x2F; required属性是否赋值，默认true</span><br><span class="line">					boolean required &#x3D; determineRequiredStatus(ann);</span><br><span class="line">					currElements.add(new AutowiredFieldElement(field, required));</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">			&#x2F;&#x2F; 同理通过反射获取所有方法并处理被autowired修饰的方法</span><br><span class="line">			ReflectionUtils.doWithLocalMethods(targetClass, method -&gt; &#123;</span><br><span class="line">				Method bridgedMethod &#x3D; BridgeMethodResolver.findBridgedMethod(method);</span><br><span class="line">				if (!BridgeMethodResolver.isVisibilityBridgeMethodPair(method, bridgedMethod)) &#123;</span><br><span class="line">					return;</span><br><span class="line">				&#125;</span><br><span class="line">				AnnotationAttributes ann &#x3D; findAutowiredAnnotation(bridgedMethod);</span><br><span class="line">				if (ann !&#x3D; null &amp;&amp; method.equals(ClassUtils.getMostSpecificMethod(method, clazz))) &#123;</span><br><span class="line">					&#x2F;&#x2F; 是否用在static方法上</span><br><span class="line">					if (Modifier.isStatic(method.getModifiers())) &#123;</span><br><span class="line">						if (logger.isWarnEnabled()) &#123;</span><br><span class="line">							logger.warn(&quot;Autowired annotation is not supported on static methods: &quot; + method);</span><br><span class="line">						&#125;</span><br><span class="line">						return;</span><br><span class="line">					&#125;</span><br><span class="line">					if (method.getParameterCount() &#x3D;&#x3D; 0) &#123;</span><br><span class="line">						if (logger.isWarnEnabled()) &#123;</span><br><span class="line">							logger.warn(&quot;Autowired annotation should only be used on methods with parameters: &quot; +</span><br><span class="line">									method);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					boolean required &#x3D; determineRequiredStatus(ann);</span><br><span class="line">					PropertyDescriptor pd &#x3D; BeanUtils.findPropertyForMethod(bridgedMethod, clazz);</span><br><span class="line">					currElements.add(new AutowiredMethodElement(method, required, pd));</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">			&#x2F;&#x2F; 用@Autowired修饰的注解可能不止一个，因此都加在currElements这个容器里面，一起处理	</span><br><span class="line">			elements.addAll(0, currElements);</span><br><span class="line">			targetClass &#x3D; targetClass.getSuperclass();</span><br><span class="line">		&#125;</span><br><span class="line">		while (targetClass !&#x3D; null &amp;&amp; targetClass !&#x3D; Object.class);</span><br><span class="line">		&#x2F;&#x2F; 返回所有包含autowire注解修饰的一个InjectionMetadata集合</span><br><span class="line">		return new InjectionMetadata(clazz, elements);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>以上的代码就获取到了所有被autowire注解修饰的目标类和所有elements集合。<br>有了目标类，与所有需要注入的元素集合之后，我们就可以实现autowired的依赖注入逻辑了，实现的方法如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public PropertyValues postProcessPropertyValues(</span><br><span class="line">		PropertyValues pvs, PropertyDescriptor[] pds, Object bean, String beanName) throws BeanCreationException &#123;</span><br><span class="line">	&#x2F;&#x2F; 这里是之前找到的目标类和所有elements集合组成的metadata</span><br><span class="line">	InjectionMetadata metadata &#x3D; findAutowiringMetadata(beanName, bean.getClass(), pvs);</span><br><span class="line">	try &#123;</span><br><span class="line">		&#x2F;&#x2F; 然后调用metadata的inject方法</span><br><span class="line">		metadata.inject(bean, beanName, pvs);</span><br><span class="line">	&#125;</span><br><span class="line">	catch (BeanCreationException ex) &#123;</span><br><span class="line">		throw ex;</span><br><span class="line">	&#125;</span><br><span class="line">	catch (Throwable ex) &#123;</span><br><span class="line">		throw new BeanCreationException(beanName, &quot;Injection of autowired dependencies failed&quot;, ex);</span><br><span class="line">	&#125;</span><br><span class="line">	return pvs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>inject也使用了反射技术并且依然是分成字段和方法去处理的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">protected void inject(Object target, @Nullable String requestingBeanName, @Nullable PropertyValues pvs)</span><br><span class="line">				throws Throwable &#123;</span><br><span class="line">			&#x2F;&#x2F; 如果autowired修饰的是属性，则赋值</span><br><span class="line">			if (this.isField) &#123;</span><br><span class="line">				Field field &#x3D; (Field) this.member;</span><br><span class="line">				ReflectionUtils.makeAccessible(field);</span><br><span class="line">				field.set(target, getResourceToInject(target, requestingBeanName));</span><br><span class="line">			&#125;</span><br><span class="line">			else &#123;</span><br><span class="line">				if (checkPropertySkipping(pvs)) &#123;</span><br><span class="line">					return;</span><br><span class="line">				&#125;</span><br><span class="line">				&#x2F;&#x2F; 否则autowired修饰在方法上，则调用method.invoke</span><br><span class="line">				try &#123;</span><br><span class="line">					Method method &#x3D; (Method) this.member;</span><br><span class="line">					ReflectionUtils.makeAccessible(method);</span><br><span class="line">					method.invoke(target, getResourceToInject(target, requestingBeanName));</span><br><span class="line">				&#125;</span><br><span class="line">				catch (InvocationTargetException ex) &#123;</span><br><span class="line">					throw ex.getTargetException();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<p>以上就是@Autowired注解实现的所有逻辑。</p>
<h5 id="Spring中的循环依赖问题"><a href="#Spring中的循环依赖问题" class="headerlink" title="Spring中的循环依赖问题"></a>Spring中的循环依赖问题</h5><ul>
<li><p>构造器的循环依赖 </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id&#x3D;&quot;testA&quot; class&#x3D;&quot;com.bean.TestA&quot;&gt;</span><br><span class="line">    &lt;constructor-arg index&#x3D;&quot;0&quot; ref&#x3D;&quot;testB&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;testB&quot; class&#x3D;&quot;com.bean.TestB&quot;&gt;</span><br><span class="line">    &lt;constructor-arg index&#x3D;&quot;0&quot; ref&#x3D;&quot;testC&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;testC&quot; class&#x3D;&quot;com.bean.TestC&quot;&gt;</span><br><span class="line">    &lt;constructor-arg index&#x3D;&quot;0&quot; ref&#x3D;&quot;testA&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>解决方法：spring无法解决这种问题，为何？只能抛出BeanCurrentlyInCreationException异常来终止该依赖。 </li>
<li>具体的处理步骤如下： </li>
</ul>
</li>
</ul>
<pre><code>1. Spring将每个正在创建的bean的标识符放在一个池子里 
2. 如果bean在创建的时候发现自己已经存在于这个池子里 
3. 则抛出异常，中断循环依赖。</code></pre><ul>
<li><p>属性的循环依赖， setter循环依赖</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id&#x3D;&quot;testA&quot; class&#x3D;&quot;com.bean.TestA&quot;&gt;</span><br><span class="line">    &lt;property name&#x3D;&quot;testB&quot; ref&#x3D;&quot;testB&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;testB&quot; class&#x3D;&quot;com.bean.TestB&quot;&gt;</span><br><span class="line">    &lt;property name&#x3D;&quot;testC&quot; ref&#x3D;&quot;testC&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;testC&quot; class&#x3D;&quot;com.bean.TestC&quot;&gt;</span><br><span class="line">    &lt;property name&#x3D;&quot;testA&quot; ref&#x3D;&quot;testA&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>解决方法：</li>
</ul>
<ol>
<li>spring将已经完成了构造注入但是未完成setter注入的bean暴露出来 </li>
<li>当进行setter注入时，发现这个需被注入的bean已经被暴露出来（存在该bean的引用），直接注入即可，而不需要再次加载所需的bean(无需再经历从头开始加载一个bean的过程，也就不会报错了)。</li>
</ol>
</li>
</ul>
<h5 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h5><ul>
<li><p>Spring AOP是Spring框架中的重中之重，是基于JDK动态代理和CGLib动态代理实现的，至于动态代理的知识点可以参考我的这篇<a href="https://blog.csdn.net/wangchengming1/article/details/104357744" target="_blank" rel="noopener">文章</a>，Spring AOP默认采用JDK动态代理实现机制。</p>
</li>
<li><p>AOP利用一种称为“横切”的技术，剖解开封装的对象内部，并将那些影响了多个类的公共行为封装到一个可重用模块，并将其名为“Aspect”，即方面。所谓“方面”，简单地说，就是将那些与业务无关，却为业务模块所共同调用的逻辑或责任封装起来，便于减少系统的重复代码，降低模块间的耦合度，并有利于未来的可操作性和可维护性。</p>
</li>
<li><p>通俗来讲，在我们的应用中，诸如常见的日志、安全、异常处理和事物等逻辑都很重要，在不适用AOP的过去，我们需要将共同部分的这段代码写在一个独立的类独立的方法里，然后再去调用。但是有了AOP，我们就可以把几个类共有的代码，抽取到一个切片中，等到需要时再切入对象中去，从而改变其原有的行为。</p>
</li>
<li><p>AOP的基本概念</p>
<ul>
<li>通知（Advice）<br>通知定义了切面是什么以及什么时候使用。Spring切面可以应用五种类型的通知：<ul>
<li>前置通知（Before）： 在目标方法被调用之前通知功能。</li>
<li>后置通知（After）：在目标方法被调用之后通知功能。</li>
<li>返回通知（After-returning）：在目标方法执行成功之后调用通知。</li>
<li>异常通知（After-throwing）：在目标方法抛出异常之后调用通知。</li>
<li>环绕通知（Around）：通知包含了被通知的方法，在被通知的方法调用之前和调用之后执行自定义的行为。</li>
</ul>
</li>
<li>连接点（Join Point）：在应用中执行过程中能够插入切面的一个点。</li>
<li>切点（Pointcut）：切点定义了匹配通知在何处织入。</li>
<li>切面（Aspect）：切面是通知和切点的集合。通知和切点共同定义了切面的全部内容–它是什么、在何时在何处完成功能</li>
</ul>
</li>
<li><p>AOP切点表达式</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>AspectJ指示器</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>arg()</td>
<td>限制连接点匹配参数由指定类型的执行方法</td>
</tr>
<tr>
<td>@arg()</td>
<td>限制连接点匹配参数由指定注解标注的执行方法</td>
</tr>
<tr>
<td>execution()</td>
<td>用于匹配是连接点的执行方法</td>
</tr>
<tr>
<td>this()</td>
<td>限制连接点匹配AOP代理的bean引用为指定类型的类</td>
</tr>
<tr>
<td>target</td>
<td>限制连接点匹配目标对象为指定类型的类</td>
</tr>
<tr>
<td>@target()</td>
<td>限制连接点匹配特定的执行对象</td>
</tr>
<tr>
<td>within()</td>
<td>限制连接点匹配指定的类型</td>
</tr>
<tr>
<td>@within()</td>
<td>限制连接点匹配指定注解所标注的类型</td>
</tr>
<tr>
<td>@annotation</td>
<td>限制连接点匹配有指定注解的连接点</td>
</tr>
</tbody></table>
<ul>
<li>AOP使用场景<ul>
<li>Authentication 权限</li>
<li>Caching 缓存</li>
<li>Context passing 内容传递</li>
<li>Error handling 错误处理</li>
<li>Lazy loading　懒加载</li>
<li>Debugging　　调试</li>
<li>logging, tracing, profiling and monitoring　记录跟踪　优化　校准</li>
<li>Performance optimization　性能优化</li>
<li>Persistence　　持久化</li>
<li>Resource pooling　资源池</li>
<li>Synchronization　同步</li>
<li>Transactions 事务</li>
</ul>
</li>
</ul>
<h5 id="Spring事物"><a href="#Spring事物" class="headerlink" title="Spring事物"></a>Spring事物</h5><p>事务主要有四个特性，我们根据它的英文大写字母简写成：ACID</p>
<ul>
<li>原子性（Atomicity）</li>
</ul>
<p>事务是一个原子操作，由一系列动作组成。事务的原子性确保动作要么全部完成，要么完全不起作用。所以你可以把一个事务看成一个原子操作。</p>
<ul>
<li>一致性（Consistency）</li>
</ul>
<p>一旦事务完成（不管成功还是失败），系统必须确保它所建模的业务处于一致的状态，而不会是部分完成部分失败。在现实中的数据不应该被破坏。比如在银行转账的例子中，无论转账成功与否，都需要保证银行的总存款是不变的，这才符合业务的“一致”状态。</p>
<ul>
<li>隔离性（Isolation）</li>
</ul>
<p>可能有许多事务会同时处理相同的数据，因此每个事务都应该与其他事务隔离开来，防止数据损坏。这里涉及到事务的几种隔离级别，将在下文详细介绍。比如多个人都像B转账，他们之间的事务互相不能影响。</p>
<ul>
<li>持久性（Durability）</li>
</ul>
<p>一旦事务完成，无论发生什么系统错误，它的结果都不应该受到影响，这样就能从任何系统崩溃中恢复过来。通常情况下，事务的结果被写到持久化存储器（如数据库）中。</p>
<ul>
<li>事物的隔离级别<ul>
<li>Isolation.DEFAULT：用底层数据库的设置隔离级别，数据库设置的是什么我就用什么；</li>
<li>Isolation.READ_UNCOMMITTED：未提交读，最低隔离级别、事务未提交前，就可被其他事务读取（会出现幻读、脏读、不可重复读）；</li>
<li>Isolation.READ_COMMITTED：提交读，一个事务提交后才能被其他事务读取到（会造成幻读、不可重复读），SQL server 的默认级别；</li>
<li>Isolation.REPEATABLE_READ：可重复读，保证多次读取同一个数据时，其值都和事务开始时候的内容是一致，禁止读取到别的事务未提交的数据（会造成幻读），MySQL 的默认级别；</li>
<li>Isolation.SERIALIZABLE：序列化，代价最高最可靠的隔离级别，该隔离级别能防止脏读、不可重复读、幻读。</li>
<li>脏读 ：表示一个事务能够读取另一个事务中还未提交的数据。比如，某个事务尝试插入记录 A，此时该事务还未提交，然后另一个事务尝试读取到了记录 A。</li>
<li>不可重复读 ：是指在一个事务内，多次读同一数据。</li>
<li>幻读 ：指同一个事务内多次查询返回的结果集不一样。比如同一个事务 A 第一次查询时候有 n 条记录，但是第二次同等条件下查询却有 n+1 条记录，这就好像产生了幻觉。发生幻读的原因也是另外一个事务新增或者删除或者修改了第一个事务结果集里面的数据，同一个记录的数据内容被修改了，所有数据行的记录就变多或者变少了。</li>
</ul>
</li>
</ul>
<h5 id="Spring事务的传播属性"><a href="#Spring事务的传播属性" class="headerlink" title="Spring事务的传播属性"></a>Spring事务的传播属性</h5><p>在Spring的事务机制中对数据库存在7种传播行为，通过枚举类Propagation定义。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">public enum Propagation &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 需要事务，默认传播性行为。</span><br><span class="line">     * 如果当前存在事务，就沿用当前事务，否则新建一个事务运行子方法</span><br><span class="line">     *&#x2F;</span><br><span class="line">    REQUIRED(0),</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 支持事务，如果当前存在事务，就沿用当前事务，</span><br><span class="line">     * 如果不存在，则继续采用无事务的方式运行子方法</span><br><span class="line">     *&#x2F;</span><br><span class="line">    SUPPORTS(1),</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 必须使用事务，如果当前没有事务，抛出异常</span><br><span class="line">     * 如果存在当前事务,就沿用当前事务</span><br><span class="line">     *&#x2F;</span><br><span class="line">    MANDATORY(2),</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 无论当前事务是否存在，都会创建新事务允许方法</span><br><span class="line">     * 这样新事务就可以拥有新的锁和隔离级别等特性，与当前事务相互独立</span><br><span class="line">     *&#x2F;</span><br><span class="line">    REQUIRES_NEW(3),</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 不支持事务，当前存在事务时，将挂起事务，运行方法</span><br><span class="line">     *&#x2F;</span><br><span class="line">    NOT_SUPPORTED(4),</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 不支持事务，如果当前方法存在事务，将抛出异常，否则继续使用无事务机制运行</span><br><span class="line">     *&#x2F;</span><br><span class="line">    NEVER(5),</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 在当前方法调用子方法时，如果子方法发生异常</span><br><span class="line">     * 只回滚子方法执行过的SQL，而不回滚当前方法的事务</span><br><span class="line">     *&#x2F;</span><br><span class="line">    NESTED(6);</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>日常开发中基本只会使用到REQUIRED(0),REQUIRES_NEW(3),NESTED(6)三种。</p>
<h5 id="Spring-MVC有哪些组件"><a href="#Spring-MVC有哪些组件" class="headerlink" title="Spring MVC有哪些组件"></a>Spring MVC有哪些组件</h5><ul>
<li>前置控制器 DispatcherServlet。</li>
<li>映射控制器 HandlerMapping。</li>
<li>处理器 Controller。</li>
<li>模型和视图 ModelAndView。</li>
<li>视图解析器 ViewResolver。</li>
</ul>
<h5 id="Spring-MVC的运行流程"><a href="#Spring-MVC的运行流程" class="headerlink" title="Spring MVC的运行流程"></a>Spring MVC的运行流程</h5><ul>
<li>先将请求发送给 DispatcherServlet。</li>
<li>DispatcherServlet 查询一个或多个 HandlerMapping，找到处理请求的 Controller。</li>
<li>DispatcherServlet 再把请求提交到对应的 Controller。</li>
<li>Controller 进行业务逻辑处理后，会返回一个ModelAndView。</li>
<li>Dispathcher 查询一个或多个 ViewResolver 视图解析器，找到 ModelAndView 对象指定的视图对象。</li>
<li>视图对象负责渲染返回给客户端。</li>
</ul>
<h5 id="Why-Spring-Boot"><a href="#Why-Spring-Boot" class="headerlink" title="Why Spring Boot"></a>Why Spring Boot</h5><ul>
<li>自动配置</li>
<li>上手简单，简化配置，使程序人员注重在业务开发上，节省配置的时间，提升开发效率</li>
<li>Spring Boot Stater提供了开箱即用的整合，配合Maven或者Gradle构建项目</li>
<li>内嵌式Servlet容器（spring-boot-starter-web），默认是tomcat。如果想使用jetty，则需要从spring-boot-starter-web中将spring-bootstarter-tomcat排除，只留有spring-boot-starter-jetty</li>
<li>无代码生成和 xml 配置</li>
</ul>
<h5 id="Spring-Boot的核心配置文件"><a href="#Spring-Boot的核心配置文件" class="headerlink" title="Spring Boot的核心配置文件"></a>Spring Boot的核心配置文件</h5><p>Spring Boot 核心的两个配置文件：</p>
<ul>
<li>bootstrap (. yml 或者 . properties)：boostrap 由父 ApplicationContext 加载的，比 applicaton 优先加载，且 boostrap 里面的属性不能被覆盖；</li>
<li>application (. yml 或者 . properties)：用于 spring boot 项目的自动化配置。</li>
</ul>
<h5 id="Spring-Boot是如何实现自动配置的"><a href="#Spring-Boot是如何实现自动配置的" class="headerlink" title="Spring Boot是如何实现自动配置的"></a>Spring Boot是如何实现自动配置的</h5><p>众所周知，Spring Boot程序中启动类上有一个<code>@SpringBootApplication</code>注解，包含了@SpringBootConfiguration（打开是@Configuration），@EnableAutoConfiguration，@ComponentScan注解。点进去看到如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">@Target(ElementType.TYPE)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">@Inherited</span><br><span class="line">@SpringBootConfiguration</span><br><span class="line">@EnableAutoConfiguration</span><br><span class="line">@ComponentScan(excludeFilters &#x3D; &#123;</span><br><span class="line">		@Filter(type &#x3D; FilterType.CUSTOM, classes &#x3D; TypeExcludeFilter.class),</span><br><span class="line">		@Filter(type &#x3D; FilterType.CUSTOM, classes &#x3D; AutoConfigurationExcludeFilter.class) &#125;)</span><br><span class="line">public @interface SpringBootApplication &#123;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * Exclude specific auto-configuration classes such that they will never be applied.</span><br><span class="line">	 * @return the classes to exclude</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	@AliasFor(annotation &#x3D; EnableAutoConfiguration.class)</span><br><span class="line">	Class&lt;?&gt;[] exclude() default &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * Exclude specific auto-configuration class names such that they will never be</span><br><span class="line">	 * applied.</span><br><span class="line">	 * @return the class names to exclude</span><br><span class="line">	 * @since 1.3.0</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	@AliasFor(annotation &#x3D; EnableAutoConfiguration.class)</span><br><span class="line">	String[] excludeName() default &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * Base packages to scan for annotated components. Use &#123;@link #scanBasePackageClasses&#125;</span><br><span class="line">	 * for a type-safe alternative to String-based package names.</span><br><span class="line">	 * @return base packages to scan</span><br><span class="line">	 * @since 1.3.0</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	@AliasFor(annotation &#x3D; ComponentScan.class, attribute &#x3D; &quot;basePackages&quot;)</span><br><span class="line">	String[] scanBasePackages() default &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * Type-safe alternative to &#123;@link #scanBasePackages&#125; for specifying the packages to</span><br><span class="line">	 * scan for annotated components. The package of each class specified will be scanned.</span><br><span class="line">	 * &lt;p&gt;</span><br><span class="line">	 * Consider creating a special no-op marker class or interface in each package that</span><br><span class="line">	 * serves no purpose other than being referenced by this attribute.</span><br><span class="line">	 * @return base packages to scan</span><br><span class="line">	 * @since 1.3.0</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	@AliasFor(annotation &#x3D; ComponentScan.class, attribute &#x3D; &quot;basePackageClasses&quot;)</span><br><span class="line">	Class&lt;?&gt;[] scanBasePackageClasses() default &#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>@SpringBootConfiguration，这里的启动类标注了@Configuration之后，本身其实也是一个IoC容器的配置类。</li>
<li>@ComponentScan，@ComponentScan的功能其实就是自动扫描并加载符合条件的组件（比如@Component和@Repository等）或者bean定义，最终将这些bean定义加载到IoC容器中。</li>
<li>可以看到有一个注解<code>@EnableAutoConfiguration</code>，这个注解就是开启了自动配置，借助@Import的帮助，将所有符合自动配置条件的bean定义加载到IoC容器，在点进去看看</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@Target(ElementType.TYPE)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">@Inherited</span><br><span class="line">@AutoConfigurationPackage</span><br><span class="line">@Import(AutoConfigurationImportSelector.class)</span><br><span class="line">public @interface EnableAutoConfiguration &#123;</span><br><span class="line"></span><br><span class="line">	String ENABLED_OVERRIDE_PROPERTY &#x3D; &quot;spring.boot.enableautoconfiguration&quot;;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * Exclude specific auto-configuration classes such that they will never be applied.</span><br><span class="line">	 * @return the classes to exclude</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	Class&lt;?&gt;[] exclude() default &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	&#x2F;**</span><br><span class="line">	 * Exclude specific auto-configuration class names such that they will never be</span><br><span class="line">	 * applied.</span><br><span class="line">	 * @return the class names to exclude</span><br><span class="line">	 * @since 1.3.0</span><br><span class="line">	 *&#x2F;</span><br><span class="line">	String[] excludeName() default &#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>里面最关键的是@Import(EnableAutoConfigurationImportSelector.class)，借助EnableAutoConfigurationImportSelector，@EnableAutoConfiguration可以帮助SpringBoot应用将所有符合条件的@Configuration配置都加载到当前SpringBoot创建并使用的IoC容器。接下来我们看一下AutoConfigurationImportSelector，核心代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">	if (!isEnabled(annotationMetadata)) &#123;</span><br><span class="line">		return NO_IMPORTS;</span><br><span class="line">	&#125;</span><br><span class="line">	&#x2F;&#x2F; 获取元数据</span><br><span class="line">	AutoConfigurationMetadata autoConfigurationMetadata &#x3D; AutoConfigurationMetadataLoader</span><br><span class="line">			.loadMetadata(this.beanClassLoader);</span><br><span class="line">	AnnotationAttributes attributes &#x3D; getAttributes(annotationMetadata);</span><br><span class="line">	&#x2F;&#x2F; 扫描具有META-INF&#x2F;spring.factories文件的jar包</span><br><span class="line">	List&lt;String&gt; configurations &#x3D; getCandidateConfigurations(annotationMetadata,</span><br><span class="line">			attributes);</span><br><span class="line">	&#x2F;&#x2F; 去重</span><br><span class="line">	configurations &#x3D; removeDuplicates(configurations);</span><br><span class="line">	Set&lt;String&gt; exclusions &#x3D; getExclusions(annotationMetadata, attributes);</span><br><span class="line">	checkExcludedClasses(configurations, exclusions);</span><br><span class="line">	configurations.removeAll(exclusions);</span><br><span class="line">	configurations &#x3D; filter(configurations, autoConfigurationMetadata);</span><br><span class="line">	fireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class="line">	return StringUtils.toStringArray(configurations);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">protected List&lt;String&gt; getCandidateConfigurations(AnnotationMetadata metadata,</span><br><span class="line">			AnnotationAttributes attributes) &#123;</span><br><span class="line">		&#x2F;&#x2F; 加载spring.factories</span><br><span class="line">		List&lt;String&gt; configurations &#x3D; SpringFactoriesLoader.loadFactoryNames(</span><br><span class="line">				getSpringFactoriesLoaderFactoryClass(), getBeanClassLoader());</span><br><span class="line">		Assert.notEmpty(configurations,</span><br><span class="line">				&quot;No auto configuration classes found in META-INF&#x2F;spring.factories. If you &quot;</span><br><span class="line">						+ &quot;are using a custom packaging, make sure that file is correct.&quot;);</span><br><span class="line">		return configurations;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 扫描具有MEAT-INF&#x2F;spring.factories文件的jar包，得到所有的配置类</span><br><span class="line">public static List&lt;String&gt; loadFactoryNames(Class&lt;?&gt; factoryClass, @Nullable ClassLoader classLoader) &#123;</span><br><span class="line">	&#x2F;&#x2F; 自动配置器会跟根据传入的factoryClass.getName()到项目系统路径下所有的spring.factories文件中找到相应的key，从而加载里面的类。</span><br><span class="line">       String factoryClassName &#x3D; factoryClass.getName();</span><br><span class="line">       return (List)loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());</span><br><span class="line">   &#125;</span><br><span class="line">&#x2F;&#x2F; 调用loadSpringFactories</span><br><span class="line">   private static Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(@Nullable ClassLoader classLoader) &#123;</span><br><span class="line">       MultiValueMap&lt;String, String&gt; result &#x3D; (MultiValueMap)cache.get(classLoader);</span><br><span class="line">       if (result !&#x3D; null) &#123;</span><br><span class="line">           return result;</span><br><span class="line">       &#125; else &#123;</span><br><span class="line">           try &#123;</span><br><span class="line">               Enumeration&lt;URL&gt; urls &#x3D; classLoader !&#x3D; null ? classLoader.getResources(&quot;META-INF&#x2F;spring.factories&quot;) : ClassLoader.getSystemResources(&quot;META-INF&#x2F;spring.factories&quot;);</span><br><span class="line">               LinkedMultiValueMap result &#x3D; new LinkedMultiValueMap();</span><br><span class="line"></span><br><span class="line">               while(urls.hasMoreElements()) &#123;</span><br><span class="line">                   URL url &#x3D; (URL)urls.nextElement();</span><br><span class="line">                   UrlResource resource &#x3D; new UrlResource(url);</span><br><span class="line">                   Properties properties &#x3D; PropertiesLoaderUtils.loadProperties(resource);</span><br><span class="line">                   Iterator var6 &#x3D; properties.entrySet().iterator();</span><br><span class="line"></span><br><span class="line">                   while(var6.hasNext()) &#123;</span><br><span class="line">                       Entry&lt;?, ?&gt; entry &#x3D; (Entry)var6.next();</span><br><span class="line">                       List&lt;String&gt; factoryClassNames &#x3D; Arrays.asList(StringUtils.commaDelimitedListToStringArray((String)entry.getValue()));</span><br><span class="line">                       result.addAll((String)entry.getKey(), factoryClassNames);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               cache.put(classLoader, result);</span><br><span class="line">               return result;</span><br><span class="line">           &#125; catch (IOException var9) &#123;</span><br><span class="line">               throw new IllegalArgumentException(&quot;Unable to load factories from location [META-INF&#x2F;spring.factories]&quot;, var9);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>至此实现了自动配置。</p>
<h5 id="Spring-Boot是如何启动的"><a href="#Spring-Boot是如何启动的" class="headerlink" title="Spring Boot是如何启动的"></a>Spring Boot是如何启动的</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">public ConfigurableApplicationContext run(String... args) &#123;</span><br><span class="line">	StopWatch stopWatch &#x3D; new StopWatch();</span><br><span class="line">	stopWatch.start();</span><br><span class="line">	ConfigurableApplicationContext context &#x3D; null;</span><br><span class="line">	Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">	configureHeadlessProperty();</span><br><span class="line">	&#x2F;&#x2F; 通过SpringFactoriesLoader查找并加载所有的 SpringApplicationRunListeners，通过调用starting()方法通知所有的SpringApplicationRunListeners：应用开始启动了</span><br><span class="line">	SpringApplicationRunListeners listeners &#x3D; getRunListeners(args);</span><br><span class="line">	listeners.starting();</span><br><span class="line">	try &#123;</span><br><span class="line">		ApplicationArguments applicationArguments &#x3D; new DefaultApplicationArguments(</span><br><span class="line">				args);</span><br><span class="line">		&#x2F;&#x2F; 创建并配置当前应用将要使用的 Environment</span><br><span class="line">		ConfigurableEnvironment environment &#x3D; prepareEnvironment(listeners,</span><br><span class="line">				applicationArguments);</span><br><span class="line">		configureIgnoreBeanInfo(environment);</span><br><span class="line">		&#x2F;&#x2F; SpringBoot应用在启动时会输出一个大大的banner</span><br><span class="line">		Banner printedBanner &#x3D; printBanner(environment);</span><br><span class="line">		&#x2F;&#x2F; 创建不同的ApplicationContext容器</span><br><span class="line">		context &#x3D; createApplicationContext();</span><br><span class="line">		exceptionReporters &#x3D; getSpringFactoriesInstances(</span><br><span class="line">				SpringBootExceptionReporter.class,</span><br><span class="line">				new Class[] &#123; ConfigurableApplicationContext.class &#125;, context);</span><br><span class="line">		&#x2F;&#x2F; 初始化ApplicationContext</span><br><span class="line">		prepareContext(context, environment, listeners, applicationArguments,</span><br><span class="line">				printedBanner);</span><br><span class="line">		&#x2F;&#x2F; 调用ApplicationContext的refresh()方法</span><br><span class="line">		refreshContext(context);</span><br><span class="line">		&#x2F;&#x2F; 空方法</span><br><span class="line">		afterRefresh(context, applicationArguments);</span><br><span class="line">		stopWatch.stop();</span><br><span class="line">		if (this.logStartupInfo) &#123;</span><br><span class="line">			new StartupInfoLogger(this.mainApplicationClass)</span><br><span class="line">					.logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">		&#125;</span><br><span class="line">		&#x2F;&#x2F; 由 SpringApplicationRunListener 来发出 started 消息，完成最终的程序启动</span><br><span class="line">		listeners.started(context);</span><br><span class="line">		&#x2F;&#x2F; 查找当前context中是否注册有CommandLineRunner和ApplicationRunner，如果有则遍历执行它们</span><br><span class="line">		callRunners(context, applicationArguments);</span><br><span class="line">	&#125;</span><br><span class="line">	catch (Throwable ex) &#123;</span><br><span class="line">		handleRunFailure(context, ex, exceptionReporters, listeners);</span><br><span class="line">		throw new IllegalStateException(ex);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	try &#123;</span><br><span class="line">		&#x2F;&#x2F; 由 SpringApplicationRunListener 来发出 running 消息，告知程序已运行起来了</span><br><span class="line">		listeners.running(context);</span><br><span class="line">	&#125;</span><br><span class="line">	catch (Throwable ex) &#123;</span><br><span class="line">		handleRunFailure(context, ex, exceptionReporters, null);</span><br><span class="line">		throw new IllegalStateException(ex);</span><br><span class="line">	&#125;</span><br><span class="line">	return context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SpringApplicationRunListener的源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">class SpringApplicationRunListeners &#123;</span><br><span class="line"></span><br><span class="line">	private final Log log;</span><br><span class="line"></span><br><span class="line">	private final List&lt;SpringApplicationRunListener&gt; listeners;</span><br><span class="line"></span><br><span class="line">	SpringApplicationRunListeners(Log log,</span><br><span class="line">			Collection&lt;? extends SpringApplicationRunListener&gt; listeners) &#123;</span><br><span class="line">		this.log &#x3D; log;</span><br><span class="line">		this.listeners &#x3D; new ArrayList&lt;&gt;(listeners);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void starting() &#123;</span><br><span class="line">		for (SpringApplicationRunListener listener : this.listeners) &#123;</span><br><span class="line">			listener.starting();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void environmentPrepared(ConfigurableEnvironment environment) &#123;</span><br><span class="line">		for (SpringApplicationRunListener listener : this.listeners) &#123;</span><br><span class="line">			listener.environmentPrepared(environment);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void contextPrepared(ConfigurableApplicationContext context) &#123;</span><br><span class="line">		for (SpringApplicationRunListener listener : this.listeners) &#123;</span><br><span class="line">			listener.contextPrepared(context);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void contextLoaded(ConfigurableApplicationContext context) &#123;</span><br><span class="line">		for (SpringApplicationRunListener listener : this.listeners) &#123;</span><br><span class="line">			listener.contextLoaded(context);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void started(ConfigurableApplicationContext context) &#123;</span><br><span class="line">		for (SpringApplicationRunListener listener : this.listeners) &#123;</span><br><span class="line">			listener.started(context);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void running(ConfigurableApplicationContext context) &#123;</span><br><span class="line">		for (SpringApplicationRunListener listener : this.listeners) &#123;</span><br><span class="line">			listener.running(context);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void failed(ConfigurableApplicationContext context, Throwable exception) &#123;</span><br><span class="line">		for (SpringApplicationRunListener listener : this.listeners) &#123;</span><br><span class="line">			callFailedListener(listener, context, exception);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private void callFailedListener(SpringApplicationRunListener listener,</span><br><span class="line">			ConfigurableApplicationContext context, Throwable exception) &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			listener.failed(context, exception);</span><br><span class="line">		&#125;</span><br><span class="line">		catch (Throwable ex) &#123;</span><br><span class="line">			if (exception &#x3D;&#x3D; null) &#123;</span><br><span class="line">				ReflectionUtils.rethrowRuntimeException(ex);</span><br><span class="line">			&#125;</span><br><span class="line">			if (this.log.isDebugEnabled()) &#123;</span><br><span class="line">				this.log.error(&quot;Error handling failed&quot;, ex);</span><br><span class="line">			&#125;</span><br><span class="line">			else &#123;</span><br><span class="line">				String message &#x3D; ex.getMessage();</span><br><span class="line">				message &#x3D; (message !&#x3D; null) ? message : &quot;no error message&quot;;</span><br><span class="line">				this.log.warn(&quot;Error handling failed (&quot; + message + &quot;)&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Spring-Boot定义不同的环境配置"><a href="#Spring-Boot定义不同的环境配置" class="headerlink" title="Spring Boot定义不同的环境配置"></a>Spring Boot定义不同的环境配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">applcation.yml</span><br><span class="line"></span><br><span class="line">application-dev.yml</span><br><span class="line"> </span><br><span class="line">application-test.yml</span><br><span class="line"> </span><br><span class="line">application-prod.yml</span><br></pre></td></tr></table></figure>

<p>通过<code>@Profile(&quot;dev&quot;)</code>来切换不同的环境配置</p>
<h5 id="Spring-Boot如何实现跨域"><a href="#Spring-Boot如何实现跨域" class="headerlink" title="Spring Boot如何实现跨域"></a>Spring Boot如何实现跨域</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableWebMvc</span><br><span class="line">public class CorsConfig implements WebMvcConfigurer &#123;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line">    &#x2F;&#x2F; 设置允许跨域的路径</span><br><span class="line">    registry.addMapping(&quot;&#x2F;**&quot;)</span><br><span class="line">        &#x2F;&#x2F; 设置允许跨域请求的域名</span><br><span class="line">        .allowedOrigins(&quot;*&quot;)</span><br><span class="line">        &#x2F;&#x2F; 是否允许证书 不再默认开启</span><br><span class="line">        .allowCredentials(true)</span><br><span class="line">        &#x2F;&#x2F; 设置允许的方法</span><br><span class="line">        .allowedMethods(&quot;*&quot;)</span><br><span class="line">        &#x2F;&#x2F; 跨域允许时间</span><br><span class="line">        .maxAge(3600);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Spring-Boot实现多数据源配置"><a href="#Spring-Boot实现多数据源配置" class="headerlink" title="Spring Boot实现多数据源配置"></a>Spring Boot实现多数据源配置</h5><p><a href="https://www.jianshu.com/p/34730e595a8c" target="_blank" rel="noopener">请参考这篇文章</a></p>

                                                                        
                                    </div>
                                    <footer class="article-footer">
                                        <a data-url="http://wry1610.com/2020/04/17/Spring-Spring-Boot%E9%87%8D%E7%82%B9%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/" data-id="ck9chcbc7002yhzhp8eho7pkm" class="article-share-link">
                                            分享
                                        </a>
                                        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Spring-Boot/" rel="tag">Spring/Spring Boot</a></li></ul>

                                    </footer>

    </div>

    
        
  <nav class="article-nav">
    
      <a href="/2020/04/17/Spring%E4%B8%AD%E4%B8%A4%E7%A7%8D%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%EF%BC%9AJDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%92%8CCGLib%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" class="article-nav-link">
        <strong class="article-nav-caption">前一篇</strong>
        <div class="article-nav-title">
          
            Spring中两种动态代理：JDK动态代理和CGLib动态代理
          
        </div>
      </a>
    
    
      <a href="/2020/04/17/Spring-Cloud-%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA%EF%BC%88Zipkin%EF%BC%89/" class="article-nav-link">
        <strong class="article-nav-caption">后一篇</strong>
        <div class="article-nav-title">Spring Cloud - 链路追踪（Zipkin）</div>
      </a>
    
  </nav>


            

                
                    
                        
  <div class="gitalk" id="gitalk-container"></div>
  
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

  
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

  
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>

  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: 'dc4bc5e8db8ad0c02feb',
      clientSecret: 'e34658b398507219c612f0217783e96033c4cd4b',
      repo: 'BazookaW.github.io',
      owner: 'BazookaW',
      admin: ['BazookaW'],
      // id: location.pathname,      // Ensure uniqueness and length less than 50
      id: md5(location.pathname),
      distractionFreeMode: false,  // Facebook-like distraction free mode
      pagerDirection: 'last'
    })

  gitalk.render('gitalk-container')
  </script>

                            

</article>
</section>
  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
    <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2020 Wry&#39;s blog</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean" target="_blank" rel="noopener">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>
<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/favicon.ico" alt="Wry&#39;s blog"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">首页</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">归档</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/category">分类</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">关于</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="搜索">
        <i class="fe fe-search"></i>
        搜索
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>

<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




  
<script src="/js/tocbot.min.js"></script>

  <script>
    // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
    tocbot.init({
      tocSelector: '.tocbot',
      contentSelector: '.article-entry',
      headingSelector: 'h1, h2, h3, h4, h5, h6',
      hasInnerContainers: true,
      scrollSmooth: true,
      positionFixedSelector: '.tocbot',
      positionFixedClass: 'is-position-fixed',
      fixedSidebarOffset: 'auto',
    });
  </script>



<script src="/js/ocean.js"></script>


</body>
</html>